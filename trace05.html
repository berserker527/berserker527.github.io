<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<title>歌尾倾泪_第五章</title>
		<script type="text/javascript" src="js/jquery-1.7.2.js"></script>
		<style type="text/css">
			*{
				margin:0;
				padding:0;
				-moz-user-select: none;
				-webkit-user-select: none;
			}	
			h1{
				font-family:"MicroSoft YaHei";
				color:#f9bc16;
				text-align:center;
				margin:20px auto;
			}
			.context{
				width:960px;
				margin:0px auto;
				color:#039bf2;
			}
			.pager{
				width:960px;
				margin:20px auto;
			}
			.pageNum{
				float:left;
				width:24px;
				height:24px;
				line-height:24px;
				text-align:center;
				font-size:14px;
				border:1px solid #e0e0e0;
				margin:0px 3px;
				color:#039bf2;
				cursor:pointer;
			}
			.pageNum:hover{
				background:#e0e0e0;
				color:#f9bc16;
			}
			.current{
				float:left;
				width:24px;
				height:24px;
				line-height:24px;
				text-align:center;
				font-size:14px;
				border:1px solid #fff;
				color:#f9bc16;
				margin:0px 3px;
			}
			p{
				text-indent:2em;
				margin:3px auto;
				line-height:28px;
			}
			.top{
				position:fixed;
				top:0px;
				width:100%;
				height:10%;
				margin:0 auto;
				background:#414141;
				filter:alpha(opacity = 80); 
				opacity:0.8
			}
		</style>
	</head>
	<body>
		<div class="top"></div>
		<h1>Track 5 混乱的狂想曲</h1>
		<div class="context">
			正在加载，请稍等......
		</div>
		<div class="pager"></div>
		<a href="trace05.docx">下载</a>
		
	</body>
	<script type="text/javascript">
		$(function (){
			var sectionCount;
			var pageCount;
			
			function initPager(){
				$.ajax({
		          type: "GET",
		          url: "trace05.txt",
		          success: function(data){
				  	sectionCount = data.split("<br/>").length;
					pageCount = (sectionCount - 1) / 5;
					
					for (var i = 0; i < pageCount; i++) {
						if(i == 0){
							$(".pager").append('<div class="pageNum current" index="' + i + '">' + (i + 1) + '</div>');
						}
						else{
							$(".pager").append('<div class="pageNum" index="' + i + '">' + (i + 1) + '</div>');
						}
					};
					
					
					$(".pageNum").click(function(){
						$(".pageNum").removeClass("current");
						$(this).addClass("current");
						var index = $(this).attr("index");
						showContext(index);
						window.document.body.scrollTop = 0;
					});
		          }
		        });
			}
			
			function showContext(currentPage){
				$.ajax({
		          type: "GET",
		          url: "trace05.txt",
		          success: function(data){
					data = data.split("<br/>");
					
					$(".context").html("");
					for (var i = 0; i < 5; i++) {
						if(5 * currentPage + i < sectionCount){
							$(".context").append(data[5 * currentPage + i] + "<br/>")
						}
						else{
							break;
						}
					};
		          }
		        });  
			}
			  
			initPager();
			showContext(0);
			
		});
	</script>
</html>
<script>
	var tempid;
	
	$("#clean").bind("click",function(){
		$("#startDate").val('');
		$("#endDate").val('');
		$("select").val('');
		$("input[type='text']").val('');
		$("#queryForm").submit();
	});
	
	$("#opttd a").click(function(){
		var id = $(this).attr("id");
		tempid = id;
		var opt = $(this).attr("opt");
		$(".mask, ." + opt).show();
		switch(opt){
			case "operate" : operate(id); break;
			case "checkmemo" : checkmemo(id); break;
			default : break;
		};
	});
	
	function operate(id){
		$.ajax({
			type : "POST",
			url : "$appServer.get('/suggestion/suggestion_web.htm')",
			data : {id : id},
			dataType : "json",
			success : function(data){
				$(".operate .memo").val(data.memo);
				$(".operate #" + data.status).attr({"selected" : true});
			}
		});
	}
	
	function checkmemo(id){
		$.ajax({
			type : "POST",
			url : "$appServer.get('/suggestion/suggestion_web.htm')",
			data : {id : id},
			dataType : "json",
			success : function(data){
				$(".checkmemo .memo").val(data.memo);
			}
		});
	}
	
	$(".btnCancel").click(function(){
		$(".mask, .opend").hide();
	});
	
	$(".#btnOk").click(function(){
		var status = $(".operate input:selected").val();
		var memo = $(".operate .memo").val();
		$.ajax({
			type : "POST",
			url : "$appServer.get('/suggestion/suggestion_web_update.htm')",
			data : {id : tempid, status : status, memo : memo},
			dataType : "json",
			success : function(data){
				if(data == "success"){
					location.reload();
				}else{
					$(".mask, .opend").hide();
					alert("操作失败！");
				}
				
			}
		});
	});
</script>
